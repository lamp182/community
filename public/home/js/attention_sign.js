function get_forum_status(a){jQuery.ajax({type:"get",dataType:"json",url:"plugin.php?id=prestige:attention",data:{fid:fid,type:"get_forum_status",inajax:"1",timestamp:Date.parse(new Date)},success:function(b){a?b.sign_status&&(jQuery("#re-checkin-btn").remove(),jQuery("#checkin-btn").replaceWith('<span class="re-checkin-btn follow-show" id="re-checkin-btn"><span>\u5df2\u7b7e\u5230</span></span>'),get_sign_info()):show_forum_status_info(b)}})}function show_forum_status_info(a){var b=sign_html="",c=a;0==open_sign?b="":1==c.has_attention?b='<span class=\'pipe\'>|</span><span class="followed-btn follow-show" id="followed-btn">\u5df2\u5173\u6ce8</span>':(b='<span class=\'pipe\'>|</span><a href="javascript:to_attention(fid, uid)" target="_self" class="follow-btn follow-show" id="follow-btn">\u5173\u6ce8</a><span class="load-btn follow-hidden" id="load-btn"><img src="http://ue.17173cdn.com/a/bbs/shengwang/ajax-loader.gif" />\u52a0\u8f7d\u4e2d</span><span class="followed-btn follow-hidden" id="followed-btn">\u5df2\u5173\u6ce8</span>',window.attention=0),jQuery("#attention_placeholder").replaceWith(b),1==c.open_pname&&get_pinfo(),1==c.open_sign&&(sign_html=1==c.sign_status?'<span class="re-checkin-btn follow-show" id="re-checkin-btn"><span>\u5df2\u7b7e\u5230</span></span>':'<a href="javascript:to_sign(fid, uid)" class="checkin-btn follow-show" id="checkin-btn"><span>\u7b7e\u5230</span></a><span class="in-checkin-btn follow-hidden" id="in-checkin-btn"><img src="http://ue.17173cdn.com/a/bbs/shengwang/ajax-loader.gif"/><span>\u7b7e\u5230\u4e2d</span></span><span class="re-checkin-btn follow-hidden" id="re-checkin-btn"><span>\u5df2\u7b7e\u5230</span></span>',jQuery("#sign_placeholder").replaceWith(sign_html),get_sign_info())}function to_attention(a,b,c){b?jQuery.ajax({type:"get",url:"plugin.php?id=prestige:attention",data:{fid:a,type:"attention",inajax:"1",timestamp:Date.parse(new Date)},dataType:"JSON",beforeSend:function(){jQuery("#load-btn").css("display","inline-block"),jQuery("#follow-btn").css("display","none")},success:function(d){"00"==d.flag?(jQuery("#followed-btn").css("display","inline-block"),jQuery("#load-btn").css("display","none"),window.attention=1,c&&to_sign(a,b),get_forum_status(!0)):(jQuery("#in-checkin-btn").css("display","none"),jQuery("#checkin-btn").css("display","inline-block"),jQuery("#follow-btn").css("display","inline-block"),jQuery("#load-btn").css("display","none"),showDialog(d.msg))}}):lsSubmit()}function get_pinfo(){var a=null,b=!1;jQuery("#followed-btn").hover(function(){0==b&&(b=!0,jQuery.ajax({type:"get",dataType:"json",url:"plugin.php?id=prestige:attention",data:{fid:fid,type:"get_pinfo",inajax:"1",timestamp:Date.parse(new Date)},success:function(a){var b=a;jQuery("#pop-user-prank").text(b.prank),jQuery("#pop-prank-backimg").attr("style","background:url("+b.pbackimg_url+") no-repeat;"),jQuery("#pop-prank-backimg").text(""),jQuery("#pop-user-pvalue").text(b.pvalue)}}));var a=jQuery(this).position();jQuery("#pop-rank").css({left:a.left,top:a.top+28}).show()},function(){clearTimeout(a),a=setTimeout(function(){jQuery("#pop-rank").hide()},400)}),jQuery("#pop-rank").hover(function(){clearTimeout(a)},function(){jQuery("#pop-rank").hide()})}function to_sign(a,b){if(b){if(0==window.attention)return jQuery("#in-checkin-btn").css("display","inline-block"),jQuery("#checkin-btn").css("display","none"),to_attention(a,b,!0),void 0;jQuery.ajax({type:"get",dataType:"json",url:"plugin.php?id=prestige:sign",data:{fid:a,type:"sign",inajax:"1",timestamp:Date.parse(new Date)},beforeSend:function(){jQuery("#in-checkin-btn").css("display","inline-block"),jQuery("#checkin-btn").css("display","none")},success:function(a){if(0==a.flag){var b="\u7b7e\u5230\u6210\u529f";"undefined"!=typeof a.data&&("undefined"!=typeof a.data.add_all_pvalue&&a.data.add_all_pvalue&&(b+=" \u58f0\u671b+"+a.data.add_all_pvalue),"undefined"!=typeof a.data.add_all_money&&a.data.add_all_money&&(b+=" "+a.data.add_all_money_title+a.data.add_all_money)),jQuery("#re-checkin-btn").css("display","inline-block"),jQuery("#in-checkin-btn").css("display","none"),jQuery("#follow-btn").css("display","none"),jQuery("#followed-btn").css("display","inline-block"),showPrompt(null,null,"<div id='creditpromptdiv'><span><em class='desc'>"+b+"</em></span></div>",0),setTimeout(function(){hideMenu(1,"prompt"),$("append_parent").removeChild($("ntcwin"))},3e3)}else 3==a.flag?(jQuery("#re-checkin-btn").css("display","inline-block"),jQuery("#in-checkin-btn").css("display","none"),jQuery("#follow-btn").css("display","none"),jQuery("#followed-btn").css("display","inline-block")):(jQuery("#checkin-btn").css("display","inline-block"),jQuery("#in-checkin-btn").css("display","none"),showDialog(a.msg))}})}else lsSubmit()}function get_sign_info(){var a=!1,b=null;jQuery("#re-checkin-btn").hover(function(){0==a&&(a=!0,jQuery.ajax({type:"get",dataType:"json",url:"plugin.php?id=prestige:sign",data:{fid:fid,type:"get_sign_info",inajax:"1",timestamp:Date.parse(new Date)},success:function(a){var b=a;"undefined"==typeof b.sign_rank?jQuery(".diary-title").html("<h3>\u65b0\u7684\u4e00\u5929\u5f00\u59cb\u4e86!</h3><span><a href='javascript:void(0)' onclick='window.location.reload();' style='text-decoration:underline; color:#0000FF;'>\u5237\u65b0\u7b7e\u5230\u8bb0\u5f55</a></span>"):jQuery("#checkin-diary-srank").html("<strong>"+b.sign_rank+"</strong>"),jQuery("#checkin-diary-signcontidays").html("<strong>"+b.sign_count.sign_conti_days+"</strong>"),jQuery("#checkin-diary-signdayssum").html("<strong>"+b.sign_count.sign_days_sum+"</strong>");for(var c="",d="num first",e=0;e<b.sign_rank_users.length;e++)e>2&&(d="num"),c+="<li><i class='"+d+"'>"+(e+1)+"</i><a href='home.php?mod=space&uid="+b.sign_rank_users[e].uid+"' target='_blank'>"+b.sign_rank_users[e].username+"</a></li>";jQuery("#checkin-diary-users-srank").html(c)}}),jQuery("#datepicker").datepicker({onChangeMonthYear:function(a,b){setTimeout(function(){get_data_by_year_month(a,b,fid)},0)}}));var b=jQuery(this).position();jQuery("#checkin-diary").css({left:b.left,top:b.top+45}).show()},function(){clearTimeout(b),b=setTimeout(function(){jQuery("#checkin-diary").hide()},400)}),jQuery("#checkin-diary").hover(function(){clearTimeout(b)},function(){jQuery("#checkin-diary").hide()})}function get_data_by_year_month(a,b,c){jQuery.ajax({type:"get",dataType:"json",url:"plugin.php?id=prestige:sign",data:{year:a,month:b,fid:c,type:"getsigndata",inajax:"1"},success:function(c){var d=c,e=new Date,f=e.getFullYear()+""+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+(e.getDate()<10?"0"+e.getDate():e.getDate());jQuery("#datepicker td").unbind("click").removeAttr("onclick").find("a").unbind("click").removeAttr("href"),jQuery(".ui-datepicker-year").text()==a&&jQuery(".ui-datepicker-month").text()==b+"\u6708"&&jQuery("#datepicker td").not(jQuery(".ui-datepicker-other-month")).each(function(){for(var c=jQuery(this),e=a+""+(10>b?"0"+b:b)+(c.text()<10?"0"+c.text():c.text()),g=0;g<d.length;g++){if(c.text()==d[g].sign_day){c.addClass("current"),function(){d[g]}();break}parseInt(e)>=parseInt(f)&&c.addClass("nextday")}0==d.length&&c.addClass("nextday")})}})}jQuery(function(a){a.datepicker.regional["zh-CN"]={clearText:"\u6e05\u9664",clearStatus:"\u6e05\u9664\u5df2\u9009\u65e5\u671f",closeText:"\u5173\u95ed",closeStatus:"\u4e0d\u6539\u53d8\u5f53\u524d\u9009\u62e9",prevText:"<\u4e0a\u6708",prevStatus:"\u663e\u793a\u4e0a\u6708",prevBigText:"<<",prevBigStatus:"\u663e\u793a\u4e0a\u4e00\u5e74",nextText:"\u4e0b\u6708>",nextStatus:"\u663e\u793a\u4e0b\u6708",nextBigText:">>",nextBigStatus:"\u663e\u793a\u4e0b\u4e00\u5e74",currentText:"\u4eca\u5929",currentStatus:"\u663e\u793a\u672c\u6708",monthNames:["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],monthNamesShort:["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c"],monthStatus:"\u9009\u62e9\u6708\u4efd",yearStatus:"\u9009\u62e9\u5e74\u4efd",weekHeader:"\u5468",weekStatus:"\u5e74\u5185\u5468\u6b21",dayNames:["\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],dayNamesShort:["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],dayNamesMin:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],dayStatus:"\u8bbe\u7f6e DD \u4e3a\u4e00\u5468\u8d77\u59cb",dateStatus:"\u9009\u62e9 m\u6708 d\u65e5, DD",dateFormat:"yy-mm-dd",firstDay:1,initStatus:"\u8bf7\u9009\u62e9\u65e5\u671f",isRTL:!1},a.datepicker.setDefaults(a.datepicker.regional["zh-CN"])}),jQuery(function(){var a=new Array;a.open_pname=open_pname,a.open_sign=open_sign,a.has_attention=a.sign_status=0;var b=getcookie(uid+"_prestige_attention_sign_status_"+now_date);if(b.length>0&&forum_id>0){for(var c=0,d=b.split(","),e=0;e<d.length;e++)if(d[e].indexOf(forum_id)>=0){var f=d[e].split("_");a.has_attention=f[1],a.sign_status=f[2],c=1,show_forum_status_info(a);break}0==c&&get_forum_status()}else 0==uid.length?show_forum_status_info(a):get_forum_status()});